<app-vulnerability-bar
  [critical]="namespace?.criticalCount"
  [high]="namespace?.highCount"
  [medium]="namespace?.mediumCount"
  [low]="namespace?.lowCount"
  [total]="namespace?.total"
></app-vulnerability-bar>

<p-table
  [sortOrder]="-1"
  sortField="criticalCount"
  [value]="namespace?.reports"
  styleClass="p-datatable-striped"
  [rows]="10"
  dataKey="name"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="rowsPerPage"
  [paginator]="true"
>
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 5rem" class="p-1"></th>
      <th pSortableColumn="owner_ref.kind">
        {{ 'pages.clusters.details.vulnerabilityreports.kind' | translate }} <p-sortIcon field="owner_ref.kind"></p-sortIcon>
      </th>
      <th pSortableColumn="owner_ref.name" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.name' | translate }} <p-sortIcon field="owner_ref.name"></p-sortIcon>
      </th>
      <th pSortableColumn="artifact.repository" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.artifactRepository' | translate }} <p-sortIcon field="artifact.repository"></p-sortIcon>
      </th>
      <th pSortableColumn="artifact.tag" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.artifactTag' | translate }} <p-sortIcon field="artifact.tag"></p-sortIcon>
      </th>
      <th pSortableColumn="criticalCount" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.critical' | translate }} ({{ namespace?.criticalCount }})
        <p-sortIcon field="criticalCount"></p-sortIcon>
      </th>
      <th pSortableColumn="highCount" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.high' | translate }} ({{ namespace?.highCount }}) <p-sortIcon field="highCount"></p-sortIcon>
      </th>
      <th pSortableColumn="mediumCount" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.medium' | translate }} ({{ namespace?.mediumCount }})
        <p-sortIcon field="mediumCount"></p-sortIcon>
      </th>
      <th pSortableColumn="lowCount" class="p-1">
        {{ 'pages.clusters.details.vulnerabilityreports.low' | translate }} ({{ namespace?.lowCount }}) <p-sortIcon field="lowCount"></p-sortIcon>
      </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-report let-nestedExpanded="expanded">
    <tr>
      <td>
        <button
          type="button"
          pButton
          pRipple
          [pRowToggler]="report"
          class="p-button-text p-button-rounded p-button-plain"
          [icon]="nestedExpanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
        ></button>
      </td>
      <td>
        {{ report?.owner_ref?.kind }}
      </td>
      <td>
        {{ report?.owner_ref?.name }}
      </td>
      <td>
        {{ report?.artifact?.repository }}
      </td>
      <td>
        {{ report?.artifact?.tag }}
      </td>
      <td>{{ report?.criticalCount }}</td>
      <td>{{ report?.highCount }}</td>
      <td>{{ report?.mediumCount }}</td>
      <td>{{ report?.lowCount }}</td>
    </tr>
  </ng-template>
  <ng-template pTemplate="rowexpansion" let-report>
    <tr>
      <td colspan="10">
        <app-vulnerability-report [report]="report"></app-vulnerability-report>
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="6">
        {{ 'common.emptyList' | translate }}
      </td>
    </tr>
  </ng-template>
</p-table>
